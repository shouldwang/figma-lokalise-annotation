<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lokalise Project Setting</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, 'Liberation Sans', 'Nimbus Sans', 'sans-serif';
      margin: 0;
      background: #fafafa;
      height: 100vh;
    }
    .center {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100vh;
      padding: 12px;
      box-sizing: border-box;
    }
    .setting-container {
      display: flex;
      flex-direction: column;
      gap: 16px
    }

    h4 {
      margin: 0 0 2px 0;
      font-family: inherit;
      font-weight: 600;
      font-size: 14px;
    }
    .desc span, .language-field span { 
      font-size: 14px;
      color: #777;
      line-height: 1.5; 
    }
    
    /* Language Settings Styles */
    .language-dropdown-container {
      position: relative;
      width: 100%;
      margin: 8px 0;
    }
    
    .language-search-input {
      width: 100%;
      height: 40px;
      padding: 8px 32px 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      background: #fff;
      cursor: pointer;
      box-sizing: border-box;
    }
    
    .language-search-input:focus {
      outline: none;
      border-color: #1d4ed8;
      box-shadow: 0 0 0 2px rgba(29, 78, 216, 0.1);
    }
    
    .language-dropdown-arrow {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: #666;
      font-size: 12px;
    }
    
    .language-dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 200px;
      background: #fff;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 4px 4px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }
    
    .language-dropdown-item {
      padding: 8px 12px;
      font-size: 14px;
      color: #333;
      cursor: pointer;
      transition: background 0.15s;
    }
    
    .language-dropdown-item:hover {
      background: #f5f7fa;
    }
    
    .language-dropdown-item.selected {
      background: #1d4ed8;
      color: #fff;
    }
    
    .language-dropdown-item.highlighted {
      background: #e5e7eb;
      color: #333;
    }
    
    .language-dropdown-item.selected.highlighted {
      background: #1e40af;
      color: #fff;
    }
    
    #supportedLanguagesChips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 8px 0;
      min-height: 32px;
      align-items: center;
    }
    
    .language-chip {
      display: inline-flex;
      align-items: center;
      height: 28px;
      padding: 0 8px;
      background: #e5e7eb;
      border-radius: 14px;
      font-size: 12px;
      font-weight: 600;
      color: #374151;
      gap: 6px;
    }
    
    .language-chip-remove {
      width: 16px;
      height: 16px;
      margin: 0px;
      padding: 0px;
      border-radius: 50%;
      background: #9ca3af;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
    }
    
    .language-chip-remove:hover {
      background: #6b7280;
    }

    textarea {
      font-family: inherit;
      margin: 8px 0;
      min-height: 0;
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      resize: none;
      line-height: 1.5;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    textarea::placeholder {
      line-height: 1.5;
    }
    button {
      font-size: 16px; padding: 10px 32px; border-radius: 4px; border: none;
      background: #1D4ED8; color: #fff; font-weight: 600; cursor: pointer;
      width: 100%;
      margin-top: 12px;
    }
    button:disabled { background: #b3c7e6; cursor: not-allowed; }
    .err { 
      color: #e00;
      font-weight: 500;
      font-size: 14px; 
      display: none; }
  </style>
</head>
<body>
  <div class="center">
    <div class = "setting-container">
      <!-- Project Settings -->
      <div class="desc">
        <h4>Lokalise Project Name(s)</h4>
        <span>If you have multiple, separate them with a comma (,).</span>
        <textarea id="projectInput" placeholder="e.g. proj-A, proj-B, etc."></textarea>
        <div class="err" id="errMsg"></div>
      </div>      
      <!-- Base Language -->
      <div class="language-field">
        <h4 class="language-label">Base Language</h4>
        <span>Set the base language in your product.</span>
        <div class="language-dropdown-container">
          <input 
            id="baseLanguageInput" 
            class="language-search-input" 
            type="text" 
          >
          <span class="language-dropdown-arrow">▼</span>
          <div id="baseLanguageDropdown" class="language-dropdown-list"></div>
        </div>
      </div>
      <!-- Supported Languages -->
      <div class="language-field">
        <h4 class="language-label">Supported Languages (Optional)</h4>
        <span>Pick up all supported languages in your product.</span>
        <div class="language-dropdown-container">
          <input 
            id="supportedLanguagesInput" 
            class="language-search-input" 
            type="text" 
            placeholder="Search and select languages..."
          >
          <span class="language-dropdown-arrow">▼</span>
          <div id="supportedLanguagesDropdown" class="language-dropdown-list"></div>
        </div>
        <div class="supported-languages-chips">
          <div id="supportedLanguagesChips"></div>
        </div>
      </div>
    </div>
    <button id="saveBtn" disabled>Save</button>
  </div>
  <script>
    const input = document.getElementById('projectInput');
    const btn = document.getElementById('saveBtn');
    const err = document.getElementById('errMsg');

    // Language settings variables
    let selectedBaseLanguage = { code: 'en', name: 'English' };
    let selectedSupportedLanguages = [];

    // Embedded locale data (instead of fetching from external file)
    const localeData = {
      "ab": "Abkhaz",
      "aa": "Afar",
      "af": "Afrikaans",
      "af_NA": "Afrikaans (Namibia)",
      "af_ZA": "Afrikaans (South Africa)",
      "agq": "Aghem",
      "ak": "Akan",
      "ak_GH": "Akan (Ghana)",
      "sq": "Albanian",
      "sq_AL": "Albanian (Albania)",
      "am": "Amharic",
      "ar": "Arabic",
      "ar_DZ": "Arabic (Algeria)",
      "ar_BH": "Arabic (Bahrain)",
      "ar_EG": "Arabic (Egypt)",
      "ar_IQ": "Arabic (Iraq)",
      "ar_JO": "Arabic (Jordan)",
      "ar_KW": "Arabic (Kuwait)",
      "ar_LB": "Arabic (Lebanon)",
      "ar_LY": "Arabic (Libya)",
      "ar_MA": "Arabic (Morocco)",
      "ar_OM": "Arabic (Oman)",
      "ar_QA": "Arabic (Qatar)",
      "ar_SA": "Arabic (Saudi Arabia)",
      "ar_SD": "Arabic (Sudan)",
      "ar_SY": "Arabic (Syria)",
      "ar_TN": "Arabic (Tunisia)",
      "ar_AE": "Arabic (United Arab Emirates)",
      "ar_001": "Arabic (World)",
      "ar_YE": "Arabic (Yemen)",
      "an": "Aragonese",
      "hy": "Armenian",
      "as": "Assamese",
      "asa": "Asu",
      "av": "Avaric",
      "ae": "Avestan",
      "ay": "Aymara",
      "az": "Azerbaijani",
      "az_AZ": "Azerbaijani (Azerbaijan)",
      "az_Cyrl_AZ": "Azerbaijani (Cyrillic, Azerbaijan)",
      "az_Cyrl": "Azerbaijani (Cyrillic)",
      "azb": "Azerbaijani (South)",
      "ksf": "Bafia",
      "bm": "Bambara",
      "bas": "Basaa",
      "ba": "Bashkir",
      "eu_ES": "Basque (Spain)",
      "be": "Belarusian",
      "be_BY": "Belarusian (Belarus)",
      "bem": "Bemba",
      "bez": "Bena",
      "bn": "Bengali",
      "bn_BD": "Bengali (Bangladesh)",
      "bn_IN": "Bengali (India)",
      "bh": "Bihari",
      "bi": "Bislama",
      "brx": "Bodo",
      "bs_BA": "Bosnian (Bosnia and Herzegovina)",
      "br": "Breton",
      "bg": "Bulgarian",
      "bg_BG": "Bulgarian (Bulgaria)",
      "my": "Burmese",
      "ca": "Catalan",
      "ceb": "Cebuano",
      "tzm": "Central Morocco Tamazight",
      "ch": "Chamorro",
      "ce": "Chechen",
      "chr": "Cherokee",
      "ny": "Chichewa",
      "cgg": "Chiga",
      "zh_CN": "Chinese Simplified",
      "zh_Hans_CN": "Chinese Simplified (China)",
      "zh_Hans_HK": "Chinese Simplified (Hong Kong)",
      "zh_Hans_MO": "Chinese Simplified (Macau)",
      "zh_MY": "Chinese Simplified (Malay)",
      "zh_SG": "Chinese Simplified (Singapore)",
      "zh_Hans_SG": "Chinese Simplified (Singapore)",
      "zh_TW": "Chinese Traditional",
      "zh_HK": "Chinese Traditional (Hong Kong)",
      "zh_Hant_HK": "Chinese Traditional (Hong Kong)",
      "zh_Hant_MO": "Chinese Traditional (Macau)",
      "zh_Hant_TW": "Chinese Traditional (Taiwan)",
      "cu": "Church Slavic",
      "cv_CV": "Chuvash",
      "swc": "Congo Swahili",
      "kw": "Cornish",
      "co": "Corsican",
      "cr": "Cree",
      "hr": "Croatian",
      "hr_HR": "Croatian (Croatia)",
      "cs": "Czech",
      "cs_CZ": "Czech (Czech Republic)",
      "da": "Danish",
      "da_DK": "Danish (Denmark)",
      "prs": "Dari",
      "dv": "Divehi",
      "dua": "Duala",
      "nl": "Dutch",
      "nl_AW": "Dutch (Aruba)",
      "nl_BE": "Dutch (Belgium)",
      "nl_CW": "Dutch (Curaçao)",
      "nl_LU": "Dutch (Luxembourg)",
      "nl_NL": "Dutch (Netherlands)",
      "nl_SX": "Dutch (Sint Maarten)",
      "dz": "Dzongkha",
      "ebu": "Embu",
      "en": "English",
      "en_AS": "English (American Samoa)",
      "en_AU": "English (Australia)",
      "en_BB": "English (Barbados)",
      "en_BE": "English (Belgium)",
      "en_BZ": "English (Belize)",
      "en_BM": "English (Bermuda)",
      "en_BW": "English (Botswana)",
      "en_CA": "English (Canada)",
      "en_DK": "English (Denmark)",
      "en_FI": "English (Finland)",
      "en_FR": "English (France)",
      "en_GU": "English (Guam)",
      "en_GY": "English (Guyana)",
      "en_HK": "English (Hong Kong SAR China)",
      "en_IN": "English (India)",
      "en_ID": "English (Indonesia)",
      "en_IE": "English (Ireland)",
      "en_IL": "English (Israel)",
      "en_JM": "English (Jamaica)",
      "en_JP": "English (Japan)",
      "en_KR": "English (Korea)",
      "en_LU": "English (Luxembourg)",
      "en_MO": "English (Macau)",
      "en_MY": "English (Malaysia)",
      "en_MT": "English (Malta)",
      "en_MH": "English (Marshall Islands)",
      "en_MU": "English (Mauritius)",
      "en_MX": "English (Mexico)",
      "en_NA": "English (Namibia)",
      "en_NL": "English (Netherlands)",
      "en_NZ": "English (New Zealand)",
      "en_NG": "English (Nigeria)",
      "en_MP": "English (Northern Mariana Islands)",
      "en_NO": "English (Norway)",
      "en_PK": "English (Pakistan)",
      "en_PH": "English (Philippines)",
      "en_SG": "English (Singapore)",
      "en_ZA": "English (South Africa)",
      "en_ES": "English (Spain)",
      "en_SE": "English (Sweden)",
      "en_CH": "English (Switzerland)",
      "en_TW": "English (Taiwan)",
      "en_TH": "English (Thailand)",
      "en_TT": "English (Trinidad and Tobago)",
      "en_UM": "English (U.S. Minor Outlying Islands)",
      "en_VI": "English (U.S. Virgin Islands)",
      "en_AE": "English (United Arab Emirates)",
      "en_GB": "English (United Kingdom)",
      "en_US": "English (United States)",
      "en_ZW": "English (Zimbabwe)",
      "eo": "Esperanto",
      "et": "Estonian ",
      "et_EE": "Estonian (Estonia)",
      "ee": "Ewe",
      "ee_GH": "Ewe (Ghana)",
      "ee_TG": "Ewe (Togo)",
      "ewo": "Ewondo",
      "fo_FO": "Faroese (Faroe Islands)",
      "fj": "Fijian",
      "fil": "Filipino",
      "fil_PH": "Filipino (Philippines)",
      "fi": "Finnish",
      "fi_FI": "Finnish (Finland)",
      "fl": "Flemish",
      "fr": "French",
      "fr_BE": "French (Belgium)",
      "fr_BJ": "French (Benin)",
      "fr_BF": "French (Burkina Faso)",
      "fr_BI": "French (Burundi)",
      "fr_CM": "French (Cameroon)",
      "fr_CA": "French (Canada)",
      "fr_CF": "French (Central African Republic)",
      "fr_TD": "French (Chad)",
      "fr_KM": "French (Comoros)",
      "fr_CG": "French (Congo - Brazzaville)",
      "fr_CD": "French (Congo - Kinshasa)",
      "fr_CI": "French (Côte d'Ivoire)",
      "fr_DJ": "French (Djibouti)",
      "fr_GQ": "French (Equatorial Guinea)",
      "fr_FR": "French (France)",
      "fr_GF": "French (French Guiana)",
      "fr_GA": "French (Gabon)",
      "fr_GP": "French (Guadeloupe)",
      "fr_GN": "French (Guinea)",
      "fr_LU": "French (Luxembourg)",
      "fr_MG": "French (Madagascar)",
      "fr_ML": "French (Mali)",
      "fr_MQ": "French (Martinique)",
      "fr_YT": "French (Mayotte)",
      "fr_MC": "French (Monaco)",
      "fr_MA": "French (Morocco)",
      "fr_NE": "French (Niger)",
      "fr_RE": "French (Réunion)",
      "fr_RW": "French (Rwanda)",
      "fr_BL": "French (Saint Barthélemy)",
      "fr_MF": "French (Saint Martin)",
      "fr_SN": "French (Senegal)",
      "fr_CH": "French (Switzerland)",
      "fr_TG": "French (Togo)",
      "fy_NL": "Frisian",
      "ff": "Fulah",
      "gl_ES": "Galician (Spain)",
      "lg": "Ganda",
      "ka_GE": "Georgian (Georgia)",
      "de": "German",
      "de_AT": "German (Austria)",
      "de_BE": "German (Belgium)",
      "de_DE": "German (Germany)",
      "de_LI": "German (Liechtenstein)",
      "de_LU": "German (Luxembourg)",
      "de_CH": "German (Switzerland)",
      "el": "Greek",
      "el_CY": "Greek (Cyprus)",
      "el_GR": "Greek (Greece)",
      "gn": "GuaranÃ­",
      "gu_IN": "Gujarati (India)",
      "guz": "Gusii",
      "ht_HT": "Haitian Creole",
      "ha": "Hausa",
      "ha_GH": "Hausa (Ghana)",
      "ha_NE": "Hausa (Niger)",
      "ha_NG": "Hausa (Nigeria)",
      "haw": "Hawaiian",
      "he": "Hebrew",
      "he_IL": "Hebrew (Israel)",
      "hz": "Herero",
      "hi": "Hindi",
      "hi_IN": "Hindi (India)",
      "ho": "Hiri Motu",
      "hmn": "Hmong",
      "hu": "Hungarian",
      "hu_HU": "Hungarian (Hungary)",
      "is": "Icelandic",
      "is_IS": "Icelandic (Iceland)",
      "io": "Ido",
      "ig": "Igbo",
      "id": "Indonesian",
      "id_ID": "Indonesian (Indonesia)",
      "ia": "Interlingua",
      "ie": "Interlingue",
      "iu": "Inuktitut",
      "ik": "Inupiaq",
      "ga_IE": "Irish (Ireland)",
      "it": "Italian",
      "it_IT": "Italian (Italy)",
      "it_CH": "Italian (Switzerland)",
      "ja": "Japanese",
      "ja_JP": "Japanese (Japan)",
      "jv": "Javanese",
      "dyo": "Jola-Fonyi",
      "kea": "Kabuverdianu",
      "kab": "Kabyle",
      "kl": "Kalaallisut",
      "kln": "Kalenjin",
      "kam": "Kamba",
      "kn": "Kannada",
      "kn_IN": "Kannada (India)",
      "kr": "Kanuri",
      "ks": "Kashmiri",
      "kk": "Kazakh",
      "km_KH": "Khmer (Cambodia)",
      "ki": "Kikuyu",
      "rw": "Kinyarwanda",
      "tlh_KL": "Klingon",
      "kv": "Komi",
      "kg": "Kongo",
      "kok": "Konkani",
      "koo": "Konzo",
      "ko": "Korean",
      "ko_KR": "Korean (Korea)",
      "khq": "Koyra Chiini",
      "ses": "Koyraboro Senni",
      "ku_TR": "Kurdish",
      "ku_BA": "Kurdish (Badini)",
      "ku_KRM": "Kurdish (Kurmanji)",
      "ku_CKB": "Kurdish (Sorani)",
      "sdh": "Kurdish (Southern)",
      "kj": "Kwanyama",
      "nmg": "Kwasio",
      "ky": "Kyrgyz",
      "lag": "Langi",
      "laj": "Lango (Uganda)",
      "lo": "Lao",
      "la_VA": "Latin",
      "lv": "Latvian",
      "lv_LV": "Latvian (Latvia)",
      "li": "Limburgish",
      "ln": "Lingala",
      "ln_CG": "Lingala (Congo - Brazzaville)",
      "ln_CD": "Lingala (Congo - Kinshasa)",
      "lt": "Lithuanian",
      "lt_LT": "Lithuanian (Lithuania)",
      "lu": "Luba-Katanga",
      "lgg": "Lugbara",
      "luo": "Luo",
      "lb": "Luxembourgish",
      "luy": "Luyia",
      "mk_MK": "Macedonian (Macedonia)",
      "jmc": "Machame",
      "mgh": "Makhuwa-Meetto",
      "kde": "Makonde",
      "mg": "Malagasy",
      "ms": "Malay",
      "ms_BN": "Malay (Brunei)",
      "ms_MY": "Malay (Malaysia)",
      "ms_SG": "Malay (Singapore)",
      "ml": "Malayalam",
      "ml_IN": "Malayalam (India)",
      "mt_MT": "Maltese (Malta)",
      "gv": "Manx",
      "mi_NZ": "Maori",
      "mr": "Marathi",
      "mh": "Marshallese",
      "myx": "Masaaba",
      "mas": "Masai",
      "mas_KE": "Masai (Kenya)",
      "mas_TZ": "Masai (Tanzania)",
      "mer": "Meru",
      "mn_MN": "Mongolian",
      "mfe": "Morisyen",
      "mua": "Mundang",
      "naq": "Nama",
      "na": "Nauru",
      "nv": "Navajo, Navaho",
      "ndc": "Ndau",
      "ng": "Ndonga",
      "nap_IT": "Neapolitan",
      "ne": "Nepali",
      "ne_IN": "Nepali (India)",
      "ne_NP": "Nepali (Nepal)",
      "nd": "North Ndebele",
      "se": "Northern Sami",
      "no": "Norwegian",
      "no_NO": "Norwegian (Norway)",
      "nb": "Norwegian Bokmål",
      "nb_NO": "Norwegian Bokmål (Norway)",
      "nn": "Norwegian Nynorsk",
      "nn_NO": "Norwegian Nynorsk (Norway)",
      "nus": "Nuer",
      "nyn": "Nyankole",
      "oc": "Occitan",
      "oj": "Ojibwe",
      "or_IN": "Oriya (India)",
      "om": "Oromo",
      "om_ET": "Oromo (Ethiopia)",
      "om_KE": "Oromo (Kenya)",
      "os": "Ossetian, Ossetic",
      "pi": "Pali",
      "ps_AF": "Pashto (Afghanistan)",
      "nso": "Pedi",
      "fa": "Persian",
      "fa_AF": "Persian (Afghanistan)",
      "fa_IR": "Persian (Iran)",
      "pms_IT": "Piedmontese",
      "pl": "Polish",
      "pl_PL": "Polish (Poland)",
      "pt": "Portuguese",
      "pt_AO": "Portuguese (Angola)",
      "pt_BR": "Portuguese (Brazil)",
      "pt_GW": "Portuguese (Guinea - Bissau)",
      "pt_MO": "Portuguese (Macau)",
      "pt_MZ": "Portuguese (Mozambique)",
      "pt_PT": "Portuguese (Portugal)",
      "pt_ST": "Portuguese (São Tomé and Príncipe)",
      "pa": "Punjabi",
      "pa_Arab_PK": "Punjabi (Arabic, Pakistan)",
      "pa_Arab": "Punjabi (Arabic)",
      "pa_IN": "Punjabi (India)",
      "qu": "Quechua",
      "ro": "Romanian",
      "ro_MD": "Romanian (Moldova)",
      "ro_RO": "Romanian (Romania)",
      "rm": "Romansh",
      "rof": "Rombo",
      "rn": "Rundi",
      "ru": "Russian",
      "ru_AZ": "Russian (Azerbaijani)",
      "ru_BY": "Russian (Belarus)",
      "ru_IL": "Russian (Israel)",
      "ru_MD": "Russian (Moldova)",
      "ru_RU": "Russian (Russia)",
      "ru_UA": "Russian (Ukraine)",
      "rwk": "Rwa",
      "saq": "Samburu",
      "sm": "Samoan",
      "sg": "Sango",
      "sbp": "Sangu",
      "sa": "Sanskrit",
      "skr": "Saraiki",
      "sc_IT": "Sardinian",
      "gd": "Scottish Gaelic",
      "seh": "Sena",
      "swk": "Sena (Malawi)",
      "sr": "Serbian",
      "sr_BA": "Serbian (Bosnia and Herzegovina)",
      "sr_Latn_BA": "Serbian (Latin, Bosnia and Herzegovina)",
      "sr_Latn_ME": "Serbian (Latin, Montenegro)",
      "sr_Latn_RS": "Serbian (Latin, Serbia)",
      "sr_Latn": "Serbian (Latin)",
      "sr_ME": "Serbian (Montenegro)",
      "sr_RS": "Serbian (Serbia)",
      "ksb": "Shambala",
      "sn": "Shona",
      "ii": "Sichuan Yi",
      "sd": "Sindhi",
      "si": "Sinhala",
      "sk": "Slovak",
      "sk_SK": "Slovak (Slovakia)",
      "sl": "Slovenian",
      "sl_SI": "Slovenian (Slovenia)",
      "xog": "Soga",
      "so": "Somali",
      "so_DJ": "Somali (Djibouti)",
      "so_ET": "Somali (Ethiopia)",
      "so_KE": "Somali (Kenya)",
      "so_SO": "Somali (Somalia)",
      "nr": "South Ndebele",
      "st": "Southern Sotho",
      "es": "Spanish",
      "es_AR": "Spanish (Argentina)",
      "es_BO": "Spanish (Bolivia)",
      "es_CL": "Spanish (Chile)",
      "es_CO": "Spanish (Colombia)",
      "es_CR": "Spanish (Costa Rica)",
      "es_DO": "Spanish (Dominican Republic)",
      "es_EC": "Spanish (Ecuador)",
      "es_SV": "Spanish (El Salvador)",
      "es_GQ": "Spanish (Equatorial Guinea)",
      "es_GT": "Spanish (Guatemala)",
      "es_HN": "Spanish (Honduras)",
      "es_419": "Spanish (Latin America)",
      "es_MX": "Spanish (Mexico)",
      "es_NI": "Spanish (Nicaragua)",
      "es_PA": "Spanish (Panama)",
      "es_PY": "Spanish (Paraguay)",
      "es_PE": "Spanish (Peru)",
      "es_PR": "Spanish (Puerto Rico)",
      "es_ES": "Spanish (Spain)",
      "es_US": "Spanish (United States)",
      "es_UY": "Spanish (Uruguay)",
      "es_VE": "Spanish (Venezuela)",
      "su": "Sundanese",
      "sw": "Swahili",
      "sw_KE": "Swahili (Kenya)",
      "sw_TZ": "Swahili (Tanzania)",
      "ss": "Swati",
      "sv": "Swedish",
      "sv_FI": "Swedish (Finland)",
      "sv_SE": "Swedish (Sweden)",
      "gsw": "Swiss German",
      "shi": "Tachelhit",
      "shi_MA": "Tachelhit (Morocco)",
      "shi_Tfng_MA": "Tachelhit (Tifinagh, Morocco)",
      "shi_Tfng": "Tachelhit (Tifinagh)",
      "tl": "Tagalog",
      "tl_PH": "Tagalog (Philippines)",
      "ty": "Tahitian",
      "dav": "Taita",
      "tg": "Tajik",
      "ta": "Tamil",
      "ta_IN": "Tamil (India)",
      "ta_SG": "Tamil (Singapore)",
      "ta_LK": "Tamil (Sri Lanka)",
      "twq": "Tasawaq",
      "tt": "Tatar",
      "tsg": "Tausug",
      "tsg_Arab": "Tausug (Arab)",
      "te": "Telugu",
      "te_IN": "Telugu (India)",
      "teo": "Teso",
      "teo_KE": "Teso (Kenya)",
      "teo_UG": "Teso (Uganda)",
      "th": "Thai",
      "th_TH": "Thai (Thailand)",
      "bo": "Tibetan",
      "bo_CN": "Tibetan (China)",
      "bo_IN": "Tibetan (India)",
      "ti": "Tigrinya",
      "ti_ER": "Tigrinya (Eritrea)",
      "ti_ET": "Tigrinya (Ethiopia)",
      "to": "Tongan",
      "ts": "Tsonga",
      "tn": "Tswana",
      "tr": "Turkish",
      "tr_TR": "Turkish (Turkey)",
      "tk": "Turkmen",
      "tw": "Twi",
      "uk": "Ukrainian",
      "uk_UA": "Ukrainian (Ukraine)",
      "ur": "Urdu",
      "ur_IN": "Urdu (India)",
      "ur_PK": "Urdu (Pakistan)",
      "ug": "Uyghur, Uighur",
      "uz": "Uzbek",
      "uz_Arab_AF": "Uzbek (Arabic, Afghanistan)",
      "uz_Arab": "Uzbek (Arabic)",
      "uz_Latn_UZ": "Uzbek (Latin, Uzbekistan)",
      "uz_Latn": "Uzbek (Latin)",
      "uz_UZ": "Uzbek (Uzbekistan)",
      "vai": "Vai",
      "vai_Latn_LR": "Vai (Latin, Liberia)",
      "vai_Latn": "Vai (Latin)",
      "vai_LR": "Vai (Liberia)",
      "ve": "Venda",
      "vi": "Vietnamese",
      "vi_VN": "Vietnamese (Vietnam)",
      "vo": "Volapak",
      "vun": "Vunjo",
      "wa": "Walloon",
      "cy_GB": "Welsh (United Kingdom)",
      "wo": "Wolof",
      "xh": "Xhosa",
      "yav": "Yangben",
      "yi": "Yiddish",
      "yo": "Yoruba",
      "yue": "Yue Chinese (Cantonese)",
      "dje": "Zarma",
      "za": "Zhuang, Chuang",
      "zu": "Zulu"
    };

    // Default supported languages
    const defaultSupportedLanguages = [
      { code: 'ja', name: 'Japanese' },
      { code: 'en_US', name: 'English (United States)' },
      { code: 'zh_TW', name: 'Chinese Traditional' },
      { code: 'zh_CN', name: 'Chinese Simplified' }
    ];

    // Format language display text as "Name (ISO)"
    function formatLanguageDisplay(code, name) {
      return `${name} (${code})`;
    }

    // Update base language display
    function updateBaseLanguageDisplay() {
      const baseInput = document.getElementById('baseLanguageInput');
      baseInput.value = formatLanguageDisplay(selectedBaseLanguage.code, selectedBaseLanguage.name);
    }

    // Update supported languages display
    function updateSupportedLanguagesDisplay() {
      const container = document.getElementById('supportedLanguagesChips');
      
      container.innerHTML = selectedSupportedLanguages.map((lang, index) => {
        const displayText = formatLanguageDisplay(lang.code, lang.name);
        return `<div class="language-chip">
          ${displayText}
          <button class="language-chip-remove" data-index="${index}">×</button>
        </div>`;
      }).join('');
      
      // Bind remove events
      container.querySelectorAll('.language-chip-remove').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.dataset.index);
          selectedSupportedLanguages.splice(index, 1);
          updateSupportedLanguagesDisplay();
          renderSupportedLanguageOptions();
        });
      });
    }

    // Initialize language settings (no longer async since data is embedded)
    function initializeLanguageSettings() {
      console.log('Initializing language settings with', Object.keys(localeData).length, 'languages');
      setupBaseLanguageDropdown();
      setupSupportedLanguagesDropdown();
      updateBaseLanguageDisplay();
      updateSupportedLanguagesDisplay();
    }

    let isBaseLanguageSearching = false;
    let baseLanguageHighlightedIndex = -1;
    let supportedLanguageHighlightedIndex = -1;

    // Setup base language dropdown
    function setupBaseLanguageDropdown() {
      const baseInput = document.getElementById('baseLanguageInput');
      const dropdown = document.getElementById('baseLanguageDropdown');
      
      baseInput.addEventListener('focus', () => {
        renderBaseLanguageOptions();
        dropdown.style.display = 'block';
        baseLanguageHighlightedIndex = -1;
      });
      
      baseInput.addEventListener('input', (e) => {
        isBaseLanguageSearching = true;
        renderBaseLanguageOptions(e.target.value);
        dropdown.style.display = 'block';
        baseLanguageHighlightedIndex = 0; // Auto-highlight first item when typing
        updateBaseLanguageHighlight();
      });
      
      baseInput.addEventListener('keydown', (e) => {
        const dropdown = document.getElementById('baseLanguageDropdown');
        const items = dropdown.querySelectorAll('.language-dropdown-item');
        
        if (dropdown.style.display === 'block' && items.length > 0) {
          switch (e.key) {
            case 'ArrowDown':
              e.preventDefault();
              baseLanguageHighlightedIndex = (baseLanguageHighlightedIndex + 1) % items.length;
              updateBaseLanguageHighlight();
              break;
            case 'ArrowUp':
              e.preventDefault();
              baseLanguageHighlightedIndex = baseLanguageHighlightedIndex <= 0 ? items.length - 1 : baseLanguageHighlightedIndex - 1;
              updateBaseLanguageHighlight();
              break;
            case 'Enter':
              e.preventDefault();
              if (baseLanguageHighlightedIndex >= 0 && baseLanguageHighlightedIndex < items.length) {
                const selectedItem = items[baseLanguageHighlightedIndex];
                const code = selectedItem.dataset.code;
                const name = selectedItem.dataset.name;
                selectedBaseLanguage = { code, name };
                updateBaseLanguageDisplay();
                dropdown.style.display = 'none';
                isBaseLanguageSearching = false;
                baseLanguageHighlightedIndex = -1;
              }
              break;
            case 'Escape':
              dropdown.style.display = 'none';
              updateBaseLanguageDisplay();
              isBaseLanguageSearching = false;
              baseLanguageHighlightedIndex = -1;
              break;
          }
        } else {
          // Clear field on first character input if not already searching
          if (!isBaseLanguageSearching && e.key.length === 1) {
            baseInput.value = '';
            isBaseLanguageSearching = true;
          }
        }
      });
      
      document.addEventListener('click', (e) => {
        if (!baseInput.parentElement.contains(e.target)) {
          dropdown.style.display = 'none';
          // Reset to selected value if not searching or no selection made
          if (!isBaseLanguageSearching || baseInput.value === '') {
            updateBaseLanguageDisplay();
          }
          isBaseLanguageSearching = false;
          baseLanguageHighlightedIndex = -1;
        }
      });
    }

    // Setup supported languages dropdown
    function setupSupportedLanguagesDropdown() {
      const supportedInput = document.getElementById('supportedLanguagesInput');
      const dropdown = document.getElementById('supportedLanguagesDropdown');

      supportedInput.addEventListener('input', (e) => {
        renderSupportedLanguageOptions(e.target.value);
        dropdown.style.display = 'block';
        supportedLanguageHighlightedIndex = 0; // Auto-highlight first item when typing
        updateSupportedLanguageHighlight();
      });
      
      supportedInput.addEventListener('focus', () => {
        renderSupportedLanguageOptions(supportedInput.value);
        dropdown.style.display = 'block';
        supportedLanguageHighlightedIndex = -1;
      });
      
      supportedInput.addEventListener('keydown', (e) => {
        const dropdown = document.getElementById('supportedLanguagesDropdown');
        const items = dropdown.querySelectorAll('.language-dropdown-item');
        
        if (dropdown.style.display === 'block' && items.length > 0) {
          switch (e.key) {
            case 'ArrowDown':
              e.preventDefault();
              supportedLanguageHighlightedIndex = (supportedLanguageHighlightedIndex + 1) % items.length;
              updateSupportedLanguageHighlight();
              break;
            case 'ArrowUp':
              e.preventDefault();
              supportedLanguageHighlightedIndex = supportedLanguageHighlightedIndex <= 0 ? items.length - 1 : supportedLanguageHighlightedIndex - 1;
              updateSupportedLanguageHighlight();
              break;
            case 'Enter':
              e.preventDefault();
              if (supportedLanguageHighlightedIndex >= 0 && supportedLanguageHighlightedIndex < items.length) {
                const selectedItem = items[supportedLanguageHighlightedIndex];
                const code = selectedItem.dataset.code;
                const name = selectedItem.dataset.name;
                selectedSupportedLanguages.push({ code, name });
                updateSupportedLanguagesDisplay();
                supportedInput.value = '';
                renderSupportedLanguageOptions();
                dropdown.style.display = 'none';
                supportedLanguageHighlightedIndex = -1;
              }
              break;
            case 'Escape':
              dropdown.style.display = 'none';
              supportedInput.value = '';
              supportedLanguageHighlightedIndex = -1;
              break;
          }
        }
      });
      
      document.addEventListener('click', (e) => {
        if (!supportedInput.parentElement.contains(e.target)) {
          dropdown.style.display = 'none';
          supportedInput.value = '';
          supportedLanguageHighlightedIndex = -1;
        }
      });
    }

    // Update base language highlight
    function updateBaseLanguageHighlight() {
      const dropdown = document.getElementById('baseLanguageDropdown');
      const items = dropdown.querySelectorAll('.language-dropdown-item');
      
      items.forEach((item, index) => {
        item.classList.remove('highlighted');
        if (index === baseLanguageHighlightedIndex) {
          item.classList.add('highlighted');
          item.scrollIntoView({ block: 'nearest' });
        }
      });
    }

    // Update supported language highlight
    function updateSupportedLanguageHighlight() {
      const dropdown = document.getElementById('supportedLanguagesDropdown');
      const items = dropdown.querySelectorAll('.language-dropdown-item');
      
      items.forEach((item, index) => {
        item.classList.remove('highlighted');
        if (index === supportedLanguageHighlightedIndex) {
          item.classList.add('highlighted');
          item.scrollIntoView({ block: 'nearest' });
        }
      });
    }

    // Render base language options
    function renderBaseLanguageOptions(searchTerm = '') {
      const dropdown = document.getElementById('baseLanguageDropdown');
      
      // Convert localeData object to array and filter
      const filteredLanguages = Object.entries(localeData).filter(([code, name]) => {
        const displayText = formatLanguageDisplay(code, name);
        return displayText.toLowerCase().includes(searchTerm.toLowerCase());
      });
      
      dropdown.innerHTML = filteredLanguages.map(([code, name]) => {
        const displayText = formatLanguageDisplay(code, name);
        const isSelected = selectedBaseLanguage.code === code;
        return `<div class="language-dropdown-item ${isSelected ? 'selected' : ''}" data-code="${code}" data-name="${name}">
          ${displayText}
        </div>`;
      }).join('');
      
      // Bind click events
      dropdown.querySelectorAll('.language-dropdown-item').forEach((item, index) => {
        item.addEventListener('click', () => {
          const code = item.dataset.code;
          const name = item.dataset.name;
          selectedBaseLanguage = { code, name };
          updateBaseLanguageDisplay();
          dropdown.style.display = 'none';
          isBaseLanguageSearching = false;
          baseLanguageHighlightedIndex = -1;
        });
        
        item.addEventListener('mouseenter', () => {
          baseLanguageHighlightedIndex = index;
          updateBaseLanguageHighlight();
        });
      });
      
      // Reset highlight index if search results changed
      if (baseLanguageHighlightedIndex >= filteredLanguages.length) {
        baseLanguageHighlightedIndex = filteredLanguages.length > 0 ? 0 : -1;
      }
      updateBaseLanguageHighlight();
    }

    // Render supported language options
    function renderSupportedLanguageOptions(searchTerm = '') {
      const dropdown = document.getElementById('supportedLanguagesDropdown');
      const selectedCodes = selectedSupportedLanguages.map(lang => lang.code);
      
      // Convert localeData object to array and filter
      const filteredLanguages = Object.entries(localeData).filter(([code, name]) => {
        const displayText = formatLanguageDisplay(code, name);
        return displayText.toLowerCase().includes(searchTerm.toLowerCase()) && 
               !selectedCodes.includes(code);
      });
      
      dropdown.innerHTML = filteredLanguages.map(([code, name]) => {
        const displayText = formatLanguageDisplay(code, name);
        return `<div class="language-dropdown-item" data-code="${code}" data-name="${name}">
          ${displayText}
        </div>`;
      }).join('');
      
      // Bind click events
      dropdown.querySelectorAll('.language-dropdown-item').forEach((item, index) => {
        item.addEventListener('click', () => {
          const code = item.dataset.code;
          const name = item.dataset.name;
          selectedSupportedLanguages.push({ code, name });
          updateSupportedLanguagesDisplay();
          document.getElementById('supportedLanguagesInput').value = '';
          renderSupportedLanguageOptions();
          dropdown.style.display = 'none';
          supportedLanguageHighlightedIndex = -1;
        });
        
        item.addEventListener('mouseenter', () => {
          supportedLanguageHighlightedIndex = index;
          updateSupportedLanguageHighlight();
        });
      });
      
      // Reset highlight index if search results changed
      if (supportedLanguageHighlightedIndex >= filteredLanguages.length) {
        supportedLanguageHighlightedIndex = filteredLanguages.length > 0 ? 0 : -1;
      }
      updateSupportedLanguageHighlight();
    }

    // Save language settings to plugin
    function saveLanguageSettingsToPlugin() {
      const languageSettings = {
        baseLanguage: selectedBaseLanguage,
        supportedLanguages: selectedSupportedLanguages
      };
      parent.postMessage({ 
        pluginMessage: { 
          type: "save-language-settings", 
          languageSettings 
        } 
      }, "*");
    }

    // Get language settings from plugin
    function getLanguageSettingsFromPlugin() {
      parent.postMessage({ pluginMessage: { type: "get-language-settings" } }, "*");
    }

    // 取得現有資料
    function getProjectsFromPlugin() {
      parent.postMessage({ pluginMessage: { type: "get-projects" } }, "*");
    }

    // 儲存資料
    function saveProjectsToPlugin(arr) {
      parent.postMessage({ pluginMessage: { type: "save-projects", projects: arr } }, "*");
    }

    function validate() {
      const arr = input.value.split(',').map(s => s.trim()).filter(Boolean);
      if (arr.length === 0) {
        err.textContent = "Please enter at least one project.";
        err.style.display = 'block';
        btn.disabled = true;
        return false;
      }
      err.style.display = 'none';
      btn.disabled = false;
      return true;
    }

    input.addEventListener('input', validate);
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !btn.disabled) btn.click();
    });

    btn.onclick = function() {
      if (!validate()) return;
      const arr = input.value.split(',').map(s => s.trim()).filter(Boolean);
      saveProjectsToPlugin(arr);
      saveLanguageSettingsToPlugin();
    };

    // 接收 plugin 回傳的資料
    window.onmessage = function(event) {
      const msg = event.data.pluginMessage;
      if (!msg) return;
      
      if (msg.type === "project-list") {
        if (Array.isArray(msg.projects) && msg.projects.length) {
          input.value = msg.projects.join(', ');
        } else {
          input.value = "";
        }
        validate();
      }
      
      if (msg.type === "language-settings") {
        if (msg.languageSettings) {
          const { baseLanguage, supportedLanguages } = msg.languageSettings;
          if (baseLanguage && baseLanguage.code && baseLanguage.name) {
            selectedBaseLanguage = baseLanguage;
          }
          if (Array.isArray(supportedLanguages)) {
            selectedSupportedLanguages = supportedLanguages;
          }
          updateBaseLanguageDisplay();
          updateSupportedLanguagesDisplay();
        } else {
          // First time setup - use defaults
          selectedSupportedLanguages = [...defaultSupportedLanguages];
          updateBaseLanguageDisplay();
          updateSupportedLanguagesDisplay();
        }
      }
      
      if (msg.type === "save-success") {
        parent.postMessage({ pluginMessage: { type: 'close-plugin' } }, '*');
      }
    };

    // 初次載入時取得現有資料
    window.onload = function() {
      initializeLanguageSettings(); // No longer needs await
      getProjectsFromPlugin();
      getLanguageSettingsFromPlugin();
      validate();
    };

    // 支援 ESC 關閉
    window.addEventListener('keydown', e => {
      if (e.key === 'Escape') parent.postMessage({ pluginMessage: { type: 'close-plugin' } }, '*');
    });
  </script>
</body>
</html>